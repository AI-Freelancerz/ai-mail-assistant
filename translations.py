# translations.py

LANGUAGES = {
    "en": "English",
    "fr": "Fran√ßais",
}

# This dictionary holds your translations.
# The structure is: {language_code: {key: translation_string}}
TRANSLATIONS = {
    "en": {
        "AI Email Assistant": "AI Email Assistant",
        "Welcome to the AI Email Assistant!": "Welcome to the AI Email Assistant!",
        "Select your language": "Select your language", # This is the hardcoded label, so it's fine
        "Generate Email": "Generate Email",
        "Compose your email details below.": "Compose your email details below.",
        "Recipient": "Recipient",
        "Subject": "Subject",
        "Sender": "Sender",
        "Clear Form": "Clear Form",
        "Your email has been generated! You can modify it below.": "Your email has been generated! You can modify it below.",
        "Error generating email. Please try again.": "Error generating email. Please try again.",
        "Recipient, Subject, and Body cannot be empty.": "Recipient, Subject, and Body cannot be empty.",
        "Enter a recipient": "Enter a recipient",
        "Enter a subject": "Enter a subject",
        "Enter email body": "Enter email body",
        "Enter sender name or email": "Enter sender name or email",
        # New Translations
        "1. Generation": "1. Generation",
        "2. Preview": "2. Preview",
        "3. Results": "3. Results",
        "Email sent successfully!": "Email sent successfully!",
        "Back to Generation": "Back to Generation",
        "Editable Email Content": "Editable Email Content",
        "Live Preview for First Contact": "Live Preview for First Contact",
        "Edit the email template here. Changes will reflect in the live preview.": "Edit the email template here. Changes will reflect in the live preview.",
        "This shows how the email will appear for the first contact. To make changes, use the *Editable Email Content* section on the left.": "This shows how the email will appear for the first contact. To make changes, use the 'Editable Email Content' section on the left.",
        "Add Attachments": "Add Attachments",
        "Upload files": "Upload files",
        "Current Attachments": "Current Attachments",
        "Confirm Send": "Confirm Send",
        "No contacts loaded to send emails to.": "No contacts loaded to send emails to.",
        "Subject and Body cannot be empty. Please go back to Generation if needed.": "Subject and Body cannot be empty. Please go back to Generation if needed.",
        "All emails sent successfully!": "All emails sent successfully!",
        "All {count} emails were sent without any issues.": "All {count} emails were sent without any issues.",
        "Sending complete with errors.": "Sending complete with errors.",
        "Some emails failed to send. Please check the log below for details.": "Some emails failed to send. Please check the log below for details.",
        "No emails were processed.": "No emails were processed.",
        "Total Contacts Processed": "Total Contacts Processed",
        "Emails Sent Successfully": "Emails Sent Successfully",
        "Emails Failed to Send": "Emails Failed to Send",
        "Show Activity Log and Errors": "Show Activity Log and Errors",
        "Individual Email Status & Events": "Individual Email Status & Events",
        "Message ID": "Message ID",
        "Refresh Events for this Email": "Refresh Events for this Email",
        "Events": "Events",
        "No events found yet for this message. Click 'Refresh Events' to check.": "Aucun √©v√©nement trouv√© pour ce message. Cliquez sur 'Actualiser les √©v√©nements' pour v√©rifier.",
        "Fetching email delivery status...": "R√©cup√©ration du statut de livraison de l'e-mail...",
        "Activity Log": "Activity Log",
        "Start New Email Session": "Start New Email Session",
        "AI Instruction: Describe the email you want to generate.": "AI Instruction: Describe the email you want to generate.",
        "e.g., 'Draft a newsletter about our new product features.'": "e.g., 'Draft a newsletter about our new product features.'",
        "Email Context (optional): Add style, tone, or specific details.": "Email Context (optional): Add style, tone, or specific details.",
        "e.g., 'Friendly tone, include a call to action to visit our website.'": "e.g., 'Friendly tone, include a call to action to visit our website.'",
        "Personalize emails?": "Personalize emails?",
        "Generic Greeting (e.g., 'Dear Valued Customer')": "Generic Greeting (e.g., 'Dear Valued Customer')",
        "Enter a generic greeting if not personalizing": "Enter a generic greeting if not personalizing",
        "Add a Custom Button?": "Add a Custom Button?",
        "Custom Button Text": "Custom Button Text",
        "e.g., 'Learn More'": "e.g., 'Learn More'",
        "Button URL": "Button URL",
        "e.g., 'https://your-website.com'": "e.g., 'https://your-website.com'",
        "Please provide instructions for the AI to generate the email.": "Please provide instructions for the AI to generate the email.",
        "Successfully loaded {count} valid contacts.": "Successfully loaded {count} valid contacts.",
        "WARNING: Some contacts had issues (e.g., missing/invalid/duplicate emails). They will be skipped.": "WARNING: Some contacts had issues (e.g., missing/invalid/duplicate emails). They will be skipped.",
        "No valid contacts found in the Excel file.": "No valid contacts found in the Excel file.",
        "Please upload an Excel file to get started.": "Please upload an Excel file to get started.",
        "Sender Email": "Sender Email",
        "Not configured": "Not configured",
        "Sender email credentials are not configured. Please set SENDER_EMAIL and BREVO_API_KEY in Streamlit secrets.": "Sender email credentials are not configured. Please set SENDER_EMAIL and BREVO_API_KEY in Streamlit secrets.",
        "Upload Excel (.xlsx/.xls)": "Upload Excel (.xlsx/.xls)",
        "Attachments selected: {count}": "Attachments selected: {count}",
        "Donate Button Text": "Donate Now",
        "Donate Button URL": "https://www.migdal-france.org/MIGDAL-FRANCE_WEB/FR/PAIEMENT_STRIPE/DONS-PAIEMENT-CB.awp",
        "Valued Customer": "Valued Customer", # New fallback generic greeting
        "Language": "Language", # For the sidebar selectbox label
        "Dear": "Dear", # Added for dynamic salutation prefix
        "Characters: {n}": "Characters: {n}",
        "Tax Refund Text": "Your donation is eligible for a 66% tax refund.",
        "Association Info": "Migdal France | 1 rue de la Paix, 75002 Paris | contact@migdal-france.org",
        "Unsubscribe Text": "To unsubscribe from our mailing list, please click here.",
        "Row {row_num}: Invalid or missing email for '{name}' (Email: '{email}').": "Row {row_num}: Invalid or missing email for '{name}' (Email: '{email}').",
        "Email Buttons Configuration": "Email Buttons Configuration",
        "Text Before Button": "Text Before Button",
        "e.g. 'click the button below to learn more'": "e.g. 'click the button below to learn more'",
        "Button Color": "Button Color",
        "Preview Color": "Preview Color",
        "Bulk send completed successfully!": "Bulk send completed successfully!",
        "Total emails sent: {count}": "Total emails sent: {count}",
        "Success rate: {success}/{total} ({percentage:.1f}%)": "Success rate: {success}/{total} ({percentage:.1f}%)",
        "Preparing and sending emails... This may take several minutes for large lists.": "Preparing and sending emails... This may take several minutes for large lists.",
        "Generation & Setup": "Generation & Setup",
        "Preview & Send": "Preview & Send",
        "Results": "Results",
        # SMS-related translations
        "SMS (beta)": "SMS (beta)",
        "Upload Contacts": "Upload Contacts",
        "Upload an Excel file with contacts": "Upload an Excel file with contacts",
        "WARNING: Some contacts had issues (e.g., missing/invalid phone numbers). They will be skipped.": "WARNING: Some contacts had issues (e.g., missing/invalid phone numbers). They will be skipped.",
        "Re-loaded {count} valid contacts from previous upload.": "Re-loaded {count} valid contacts from previous upload.",
        "Recipients": "Recipients",
        "{n} recipients will receive this SMS": "{n} recipients will receive this SMS",
        "Compose": "Compose",
        "SMS Text": "SMS Text",
        "Write the SMS text here...": "Write the SMS text here...",
        "Send SMS": "Send SMS",
        "Too many recipients. Please send in batches of up to 2000.": "Too many recipients. Please send in batches of up to 2000.",
        "Failed to send SMS. Please check credentials/network and try again.": "Failed to send SMS. Please check credentials/network and try again.",
        "SMS batch sent": "SMS batch sent",
        "Sent with some errors: {acc} accepted, {fail} failed": "Sent with some errors: {acc} accepted, {fail} failed",
        "All messages failed to send": "All messages failed to send",
        "Requested": "Requested",
        "Accepted": "Accepted",
        "Failed": "Failed",
        "Individual SMS Status & Events": "Individual SMS Status & Events",
        "Refresh SMS Events": "Refresh SMS Events",
        "Failed to fetch SMS events for this message.": "Failed to fetch SMS events for this message.",
        "Delivery status": "Delivery status",
        "Queued": "Queued",
        "Sent": "Sent",
        "Delivered": "Delivered",
        "Unknown": "Unknown",
        "Last checked: {ts}": "Last checked: {ts}",
        "n/a": "n/a",
        "SMS mode is enabled but the SMS UI module is missing. Please ensure ui_sms.py is available.": "SMS mode is enabled but the SMS UI module is missing. Please ensure ui_sms.py is available.",
        "No recipients with a phone number found": "No recipients with a phone number found",
        "Sending Mode": "Sending Mode",
        "Select sending mode:": "Select sending mode:",
        "Production Mode": "Production Mode",
        "Test Mode": "Test Mode",
        "Production mode deduplicates phone numbers. Test mode sends to all entries including duplicates.": "Production mode deduplicates phone numbers. Test mode sends to all entries including duplicates.",
        "üì± Production Mode: Each unique phone number receives only one message, even if it appears multiple times in the Excel file.": "üì± Production Mode: Each unique phone number receives only one message, even if it appears multiple times in the Excel file.",
        "üß™ Test Mode: Messages are sent to every row in the Excel file, including duplicate phone numbers. Use this for testing large-scale sending with the same destination number.": "üß™ Test Mode: Messages are sent to every row in the Excel file, including duplicate phone numbers. Use this for testing large-scale sending with the same destination number."
    },
    "fr": {
        "AI Email Assistant": "Assistant Courriel IA",
        "Welcome to the AI Email Assistant!": "Bienvenue dans l'Assistant Courriel IA!",
        "Select your language": "S√©lectionnez votre langue",
        "Generate Email": "G√©n√©rer le Courriel",
        "Compose your email details below.": "Composez les d√©tails de votre courriel ci-dessous.",
        "Recipient": "Destinataire",
        "Subject": "Sujet",
        "Sender": "Exp√©diteur",
        "Clear Form": "Effacer le formulaire",
        "Your email has been generated! You can modify it below.": "Votre courriel a √©t√© g√©n√©r√©! Vous pouvez le modifier ci-dessous.",
        "Error generating email. Please try again.": "Erreur lors de la g√©n√©ration du courriel. Veuillez r√©essayer.",
        "Recipient, Subject, and Body cannot be empty.": "Le destinataire, le sujet et le corps ne peuvent pas √™tre vides.",
        "Enter a recipient": "Entrez un destinataire",
        "Enter a subject": "Entrez un sujet",
        "Enter email body": "Entrez le corps du courriel",
        "Enter sender name or email": "Entrez le nom ou l'adresse email de l'exp√©diteur",
        # New Translations
        "1. Generation": "1. G√©n√©ration",
        "2. Preview": "2. Pr√©visualisation",
        "3. Results": "3. R√©sultats",
        "Email sent successfully!": "Courriel envoy√© avec succ√®s!",
        "Back to Generation": "Retour √† la G√©n√©ration",
        "Editable Email Content": "Contenu du Courriel Modifiable",
        "Live Preview for First Contact": "Pr√©visualisation en Direct pour le Premier Contact",
        "Edit the email template here. Changes will reflect in the live preview.": "Modifiez le mod√®le d'e-mail ici. Les modifications se refl√©teront dans l'aper√ßu en direct.",
        "This shows how the email will appear for the first contact. To make changes, use the *Editable Email Content* section on the left.": "Ceci montre l'apparence de l'e-mail pour le premier contact. Pour apporter des modifications, utilisez la section 'Contenu de l'e-mail modifiable' sur la gauche.",
        "Add Attachments": "Ajouter des Pi√®ces Jointes",
        "Upload files": "T√©l√©charger des fichiers",
        "Current Attachments": "Pi√®ces Jointes Actuelles",
        "Confirm Send": "Confirmer l'envoi",
        "No contacts loaded to send emails to.": "Aucun contact charg√© pour envoyer des courriels.",
        "Subject and Body cannot be empty. Please go back to Generation if necessary.": "Le sujet et le corps ne peuvent pas √™tre vides. Veuillez retourner √† la G√©n√©ration si n√©cessaire.",
        "All emails sent successfully!": "Tous les courriels ont √©t√© envoy√©s avec succ√®s!",
        "All {count} emails were sent without any issues.": "Les {count} courriels ont tous √©t√© envoy√©s sans probl√®me.",
        "Sending complete with errors.": "Envoi termin√© avec des erreurs.",
        "Some emails failed to send. Please check the log below for details.": "Certains courriels n'ont pas pu √™tre envoy√©s. Veuillez v√©rifier le journal ci-dessous pour plus de d√©tails.",
        "No emails were processed.": "Aucun courriel n'a √©t√© trait√©.",
        "Total Contacts Processed": "Nombre total de contacts trait√©s",
        "Emails Sent Successfully": "Courriels envoy√©s avec succ√®s",
        "Emails Failed to Send": "Courriels non envoy√©s",
        "Show Activity Log and Errors": "Afficher le journal d'activit√© et les erreurs",
        "Individual Email Status & Events": "Statut et √©v√©nements des courriels individuels",
        "Message ID": "ID du message",
        "Refresh Events for this Email": "Actualiser les √©v√©nements pour ce courriel",
        "Events": "√âv√©nements",
        "No events found yet for this message. Click 'Refresh Events' to check.": "Aucun √©v√©nement trouv√© pour ce message. Cliquez sur 'Actualiser les √©v√©nements' pour v√©rifier.",
        "Fetching email delivery status...": "R√©cup√©ration du statut de livraison de l'e-mail...",
        "Activity Log": "Journal d'activit√©",
        "Start New Email Session": "D√©marrer une nouvelle session de courriel",
        "AI Instruction: Describe the email you want to generate.": "Instruction IA : D√©crivez le courriel que vous souhaitez g√©n√©rer.",
        "e.g., 'Draft a newsletter about our new product features.'": "ex. : 'R√©digez une newsletter sur nos nouvelles fonctionnalit√©s de produit.'",
        "Email Context (optional): Add style, tone, or specific details.": "Contexte du courriel (facultatif) : Ajoutez un style, un ton ou des d√©tails sp√©cifiques.",
        "e.g., 'Friendly tone, include a call to action to visit our website.'": "ex. : 'Ton amical, incluez un appel √† l'action pour visiter notre site web.'",
        "Personalize emails?": "Personnaliser les courriels?",
        "Generic Greeting (e.g., 'Dear Valued Customer')": "Salutation G√©n√©rique (ex. : 'Cher client')",
        "Enter a generic greeting if not personalizing": "Entrez une salutation g√©n√©rique si vous ne personnalisez pas",
        "Add a Custom Button?": "Ajouter un Bouton Personnalis√©?",
        "Custom Button Text": "Texte du Bouton Personnalis√©",
        "e.g., 'Learn More'": "ex. : 'En savoir plus'",
        "Button URL": "URL du Bouton",
        "e.g., 'https://your-website.com'": "ex. : 'https://votre-site-web.com'",
        "Please provide instructions for the AI to generate the email.": "Veuillez fournir des instructions √† l'IA pour g√©n√©rer le courriel.",
        "Successfully loaded {count} valid contacts.": "{count} contacts valides ont √©t√© charg√©s avec succ√®s.",
        "WARNING: Some contacts had issues (e.g., missing/invalid/duplicate emails). They will be skipped.": "AVERTISSEMENT : Certains contacts pr√©sentaient des probl√®mes (ex. : emails manquants/invalides/dupliqu√©s). Ils seront ignor√©s.",
        "No valid contacts found in the Excel file.": "Aucun contact valide n'a √©t√© trouv√© dans le fichier Excel.",
        "Please upload an Excel file to get started.": "Veuillez t√©l√©charger un fichier Excel pour commencer.",
        "Sender Email": "Courriel de l'exp√©diteur",
        "Not configured": "Non configur√©",
        "Sender email credentials are not configured. Please set SENDER_EMAIL and BREVO_API_KEY in Streamlit secrets.": "Les informations d'identification de l'exp√©diteur ne sont pas configur√©es. Veuillez d√©finir SENDER_EMAIL et BREVO_API_KEY dans les secrets de Streamlit.",
        "Upload Excel (.xlsx/.xls)": "T√©l√©charger un fichier Excel (.xlsx/.xls)",
        "Attachments selected: {count}": "{count} pi√®ces jointes s√©lectionn√©es",
        "Donate Button Text": "Faire un don",
        "Donate Button URL": "https://www.migdal-france.org/MIGDAL-FRANCE_WEB/FR/PAIEMENT_STRIPE/DONS-PAIEMENT-CB.awp",
        "Valued Customer": "Cher Client",
        "Language": "Langue",
        "Dear": "Cher", # Added for dynamic salutation prefix (translated to Cher for French)
        "Characters: {n}": "Caract√®res : {n}",
        "Tax Refund Text": "Votre don est √©ligible √† une d√©duction fiscale de 66%.",
        "Association Info": "Migdal France | 1 rue de la Paix, 75002 Paris | contact@migdal-france.org",
        "Unsubscribe Text": "Pour vous d√©sinscrire de notre liste de diffusion, veuillez cliquer ici.",
        "Row {row_num}: Invalid or missing email for '{name}' (Email: '{email}').": "Ligne {row_num} : Email invalide ou manquant pour '{name}' (Email : '{email}').",
        "Email Buttons Configuration": "Configuration des boutons d'e-mail",
        "Text Before Button": "Texte avant le bouton",
        "e.g. 'click the button below to learn more'": "ex. : 'cliquez sur le bouton ci-dessous pour en savoir plus'",
        "Button Color": "Couleur du bouton",
        "Preview Color": "Couleur de l'aper√ßu",
        "Bulk send completed successfully!": "Envoi group√© termin√© avec succ√®s !",
        "Total emails sent: {count}": "Nombre total d'e-mails envoy√©s : {count}",
        "Success rate: {success}/{total} ({percentage:.1f}%)": "Taux de r√©ussite : {success}/{total} ({percentage:.1f}%)",
        "Preparing and sending emails... This may take several minutes for large lists.": "Pr√©paration et envoi des e-mails... Cela peut prendre plusieurs minutes pour les grandes listes.",
        "Generation & Setup": "G√©n√©ration et configuration",
        "Preview & Send": "Aper√ßu et envoi",
        "Results": "R√©sultats",
        "Generating email with AI. This may take a few moments...": "G√©n√©ration d'email avec l'IA. Cela peut prendre quelques instants...",
        # SMS-related translations
        "SMS (beta)": "SMS (b√™ta)",
        "Upload Contacts": "T√©l√©charger les contacts",
        "Upload an Excel file with contacts": "T√©l√©charger un fichier Excel avec des contacts",
        "WARNING: Some contacts had issues (e.g., missing/invalid phone numbers). They will be skipped.": "AVERTISSEMENT : Certains contacts pr√©sentaient des probl√®mes (ex. : num√©ros de t√©l√©phone manquants/invalides). Ils seront ignor√©s.",
        "Re-loaded {count} valid contacts from previous upload.": "{count} contacts valides recharg√©s depuis le t√©l√©chargement pr√©c√©dent.",
        "Recipients": "Destinataires",
        "{n} recipients will receive this SMS": "{n} destinataires recevront ce SMS",
        "Compose": "Composer",
        "SMS Text": "Texte SMS",
        "Write the SMS text here...": "√âcrivez le texte du SMS ici...",
        "Send SMS": "Envoyer SMS",
        "Too many recipients. Please send in batches of up to 2000.": "Trop de destinataires. Veuillez envoyer par lots de 2000 maximum.",
        "Failed to send SMS. Please check credentials/network and try again.": "√âchec de l'envoi du SMS. Veuillez v√©rifier les identifiants/r√©seau et r√©essayer.",
        "SMS batch sent": "Lot SMS envoy√©",
        "Sent with some errors: {acc} accepted, {fail} failed": "Envoy√© avec des erreurs : {acc} accept√©s, {fail} √©chou√©s",
        "All messages failed to send": "Tous les messages ont √©chou√©",
        "Requested": "Demand√©s",
        "Accepted": "Accept√©s",
        "Failed": "√âchou√©s",
        "Individual SMS Status & Events": "Statut et √©v√©nements SMS individuels",
        "Refresh SMS Events": "Actualiser les √©v√©nements SMS",
        "Failed to fetch SMS events for this message.": "√âchec de la r√©cup√©ration des √©v√©nements SMS pour ce message.",
        "Delivery status": "Statut de livraison",
        "Queued": "En file d'attente",
        "Sent": "Envoy√©",
        "Delivered": "Livr√©",
        "Unknown": "Inconnu",
        "Last checked: {ts}": "Derni√®re v√©rification : {ts}",
        "n/a": "n/d",
        "SMS mode is enabled but the SMS UI module is missing. Please ensure ui_sms.py is available.": "Le mode SMS est activ√© mais le module UI SMS est manquant. Veuillez vous assurer que ui_sms.py est disponible.",
        "No recipients with a phone number found": "Aucun destinataire avec un num√©ro de t√©l√©phone trouv√©",
        "Sending Mode": "Mode d'envoi",
        "Select sending mode:": "S√©lectionnez le mode d'envoi :",
        "Production Mode": "Mode Production",
        "Test Mode": "Mode Test",
        "Production mode deduplicates phone numbers. Test mode sends to all entries including duplicates.": "Le mode Production d√©duplique les num√©ros de t√©l√©phone. Le mode Test envoie √† toutes les entr√©es, y compris les doublons.",
        "üì± Production Mode: Each unique phone number receives only one message, even if it appears multiple times in the Excel file.": "üì± Mode Production : Chaque num√©ro de t√©l√©phone unique ne re√ßoit qu'un seul message, m√™me s'il appara√Æt plusieurs fois dans le fichier Excel.",
        "üß™ Test Mode: Messages are sent to every row in the Excel file, including duplicate phone numbers. Use this for testing large-scale sending with the same destination number.": "üß™ Mode Test : Les messages sont envoy√©s √† chaque ligne du fichier Excel, y compris les num√©ros de t√©l√©phone en double. Utilisez ceci pour tester l'envoi √† grande √©chelle avec le m√™me num√©ro de destination."
    }
}

# Default language if no session state is set
DEFAULT_LANG = "en"

# Global variable to store the selected language
_selected_lang = DEFAULT_LANG

def set_language(lang_code):
    """Sets the global language for translations."""
    global _selected_lang
    if lang_code in LANGUAGES:
        _selected_lang = lang_code
    else:
        _selected_lang = DEFAULT_LANG # Fallback to default if invalid code

def _t(key, **kwargs):
    """
    Translates a given key into the selected language and formats it with kwargs.
    If the key is not found, it returns the key itself as a fallback.
    """
    translation = TRANSLATIONS.get(_selected_lang, {}).get(key, key)
    try:
        # Attempt to format the string with provided keyword arguments
        return translation.format(**kwargs)
    except KeyError as e:
        # Log or handle cases where a placeholder is missing in the translation string
        # For now, we'll just return the unformatted translation with a warning.
        print(f"Translation Error: Missing placeholder {e} for key '{key}' in language '{_selected_lang}'. Original translation: '{translation}'")
        return translation # Return unformatted string if formatting fails
    except IndexError as e:
        print(f"Translation Error: Index error {e} for key '{key}' in language '{_selected_lang}'. Original translation: '{translation}'")
        return translation # Return unformatted string if formatting fails
